!function(t){var e={setCursor:function(t,e){var t="string"==typeof t||t instanceof String?document.getElementById(t):t;if(!t)return!1;if(t.createTextRange){e+="";var n=t.createTextRange();return n.collapse(!0),n.moveEnd(e),n.moveStart(e),n.select(),!0}return t.setSelectionRange?(t.setSelectionRange(e,e),!0):!1},getCursor:function(t){if(t.selectionStart)return t.selectionStart;if(document.selection){t.focus();var e=document.selection.createRange();if(null==e)return 0;var n=t.createTextRange(),s=n.duplicate();return n.moveToBookmark(e.getBookmark()),s.setEndPoint("EndToStart",n),s.text.length}return 0}};!function(t,e){function n(t){var n=e[t];e[t]=function(t){return i(n(t))}}function s(e,n,s){return(s=this).attachEvent("on"+e,function(e){var e=e||t.event;e.preventDefault=e.preventDefault||function(){e.returnValue=!1},e.stopPropagation=e.stopPropagation||function(){e.cancelBubble=!0},n.call(s,e)})}function i(t,e){if(e=t.length)for(;e--;)t[e].addEventListener=s;else t.addEventListener=s;return t}t.addEventListener||(i([e,t]),"Element"in t?t.Element.prototype.addEventListener=s:(e.attachEvent("onreadystatechange",function(){i(e.all)}),n("getElementsByTagName"),n("getElementById"),n("createElement"),i(e.all)))}(window,document),function(){function t(t){this.el=t;for(var e=t.className.replace(/^\s+|\s+$/g,"").split(/\s+/),n=0;n<e.length;n++)s.call(this,e[n])}function e(t,e,n){Object.defineProperty?Object.defineProperty(t,e,{get:n}):t.__defineGetter__(e,n)}if(!("undefined"==typeof window.Element||"classList"in document.documentElement)){var n=Array.prototype,s=n.push,i=n.splice,a=n.join;t.prototype={add:function(t){this.contains(t)||(s.call(this,t),this.el.className=this.toString())},contains:function(t){return-1!=this.el.className.indexOf(t)},item:function(t){return this[t]||null},remove:function(t){if(this.contains(t)){for(var e=0;e<this.length&&this[e]!=t;e++);i.call(this,e,1),this.el.className=this.toString()}},toString:function(){return a.call(this," ")},toggle:function(t){return this.contains(t)?this.remove(t):this.add(t),this.contains(t)}},window.DOMTokenList=t,e(Element.prototype,"classList",function(){return new t(this)})}}();var n={symbolSets:["abcdefghijklmnopqrstuvwxyz?!;\\&-".split(""),"ABCDEFGHIJKLMNOPQRSTUVWXYZ+.@#$%".split(""),"0123456789*,_=\"'()[]{}:~^<>|".split("")],symbolSetNumber:0,petals:[],buttons:[],currentPetalNum:0,buttonMapping:{0:3,1:2,2:0,3:1},lastButtonDownId:0,lastButtonIsUp:!0,numOfPetals:8,uiElements:["left-bumper","left-analog","right-bumper","left-trigger","right-trigger"],uiLabels:{"left-bumper":"Backspace","left-analog":"Select Petal","right-bumper":"Space","left-trigger":"Numbers","right-trigger":"Caps"},gamepadConnected:!1,init:function(){this.setupElements(),this.setupStyles(),this.setupFontStyles(),this.attachSymbols(),document.addEventListener("focus",t.bind(this.onFocusEvent,this),!0),window.addEventListener("ongamepadupdate",t.bind(this.onGamepadEvent,this)),window.addEventListener("resize",t.throttle(t.bind(this.setupSize,this),100)),window.addEventListener("keyup",t.bind(function(t){27===t.which&&this.loaded&&(this.unload(),this.inputEl&&this.inputEl.blur())},this))},setupElements:function(){var t=document.createElement("div");t.id="daisywheel-js",document.body.appendChild(t),this.setupModal(),this.setupFlower(),this.setupControlsUI(),this.setupSize()},setupModal:function(){var t=document.getElementById("daisywheel-js"),e=document.createElement("div"),n=document.createElement("div"),s=document.createElement("div"),i=document.createElement("div"),a=document.createElement("div"),o=document.createElement("div"),l=document.createElement("input");i.id="daisywheel",e.id="daisywheel-modal-overlay",n.id="daisywheel-modal-container",s.id="daisywheel-modal",a.id="daisywheel-controller-warning",a.innerHTML=window.gamepadSupportAvailable?'Connect a gamepad controller to use the <a href="http://daisywheeljs.org">Daisywheel</a>':'This browser does not support the Gamepad API. Check <a href="http://caniuse.com/#feat=gamepad">this list</a> for support',o.id="daisywheel-input-container",l.id="daisywheel-input",o.appendChild(l),i.appendChild(o),s.appendChild(a),s.appendChild(i),n.appendChild(s),e.appendChild(n),t.appendChild(e)},setupFlower:function(){for(var t=document.getElementById("daisywheel"),e=document.createElement("div"),n=document.createDocumentFragment(),s=document.createElement("div"),i=document.createElement("div"),a=document.createElement("div"),o=["left","top","right","bottom"],l=0;l<o.length;l++){var r=document.createElement("div");r.className="button button-"+o[l],a.appendChild(r)}a.className="buttons",i.className="petal-inner",s.className="petal",i.appendChild(a),s.appendChild(i),n.appendChild(s);for(var d=0;d<this.numOfPetals;d++)s=n.cloneNode(!0),e.appendChild(s);this.petals=document.getElementsByClassName("petal"),e.id="daisywheel-flower",t.appendChild(e)},setupControlsUI:function(){var t=document.getElementById("daisywheel"),e=document.getElementById("daisywheel-controls-ui");e?e.innerHTML="":(e=document.createElement("div"),e.id="daisywheel-controls-ui",t.appendChild(e));for(var n=0;n<this.uiElements.length;n++){var s=document.createElement("div"),i=this.uiElements[n],a=document.createElement("div"),o=document.createElement("div"),l=this.uiLabels[i];s.id="daisywheel-"+i+"-ui",s.className="control-ui cf",a.className="control-ui-icon",o.className="control-ui-label",o.textContent=l,o.title=l,s.appendChild(a),s.appendChild(o),e.appendChild(s)}},setupSize:function(){var t=document.getElementById("daisywheel-modal"),e=window.innerWidth<window.innerHeight?window.innerWidth:window.innerHeight,n=25,s=100,i=1e3,a=Math.floor(s*(e/(i+2*n)))/s,o="scale("+a+")";t.style["-webkit-transform"]=o,t.style["-ms-transform"]=o,t.style.transform=o},setupStyles:function(){for(var t=document.createElement("style"),e="",n=208,s=160,i=640,a=640,o=2*Math.PI/this.numOfPetals,l=2*-o,r=0;r<this.numOfPetals;r++){var d=Math.round(i/2+n*Math.cos(l)-s/2),u=Math.round(a/2+n*Math.sin(l)-s/2),c=180*l/Math.PI+135;e+=["#daisywheel-js .petal:nth-of-type("+(r+1)+") {","top: "+u+"px;","left: "+d+"px;","transform: rotate("+c+"deg);","-ms-transform: rotate("+c+"deg);","-webkit-transform: rotate("+c+"deg);","} "].join(""),e+=["#daisywheel-js .petal:nth-of-type("+(r+1)+") .buttons {","transform: rotate("+-c+"deg);","-ms-transform: rotate("+-c+"deg);","-webkit-transform: rotate("+-c+"deg);","} "].join(""),l+=o}t.innerHTML=e,document.head.appendChild(t)},setupFontStyles:function(){var t="http://fonts.googleapis.com/css?family=Montserrat",e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=t,document.head.appendChild(e)},attachSymbols:function(){this.buttons=[].slice.call(document.getElementsByClassName("button"));for(var t=0;t<this.buttons.length;t++){var e=this.buttons[t],n=this.symbolSets[this.symbolSetNumber][t],s=1;n?s=1:(n="",s=.5),n.font&&(e.style.fontFamily=n.font,n=n.symbol),e.textContent=n,e.style.opacity=s}},onFocusEvent:function(t){var e=t.target;e.classList.contains("daisywheel")&&(t.preventDefault(),this.inputEl=e,this.load(this.onSymbolSelectionDefault))},showUI:function(){var t=document.getElementById("daisywheel"),e=document.getElementById("daisywheel-controller-warning");e.style.opacity=0,t.style.opacity=1},load:function(n){if(this.onSymbolSelection=n,!this.loaded){var s=document.getElementById("daisywheel-js"),i=document.getElementById("daisywheel-input");if(this.inputEl&&window.gamepadSupportAvailable){var a=this.inputEl.value;i.value=a,e.setCursor(i,a.length),this.inputEl.readOnly=!0}s.addEventListener("click",t.bind(this.unload,this)),s.style.visibility="visible",s.style.opacity=1,i.focus(),this.loaded=!0}},unload:function(e){if(this.loaded){var n=document.getElementById("daisywheel-js"),s=document.getElementById("daisywheel-input");if(e&&"daisywheel-input"===e.target.id)return;this.inputEl&&(this.inputEl.value=s.value,this.inputEl.readOnly=!1),n.removeEventListener("click",t.bind(this.unload,this)),n.style.opacity=0,n.style.visibility="hidden",this.loaded=!1}},symbols:function(t){for(var e=2,n=3,s=0;s<t.length;s++){var i=t[s],a=i.set,o=i.override;if(o&&e>-1){if(this.symbolSets.unshift(a),this.symbolSets[e]=null,i.title)switch(e){case 2:this.uiLabels["left-trigger"]=i.title;break;case 3:this.uiLabels["right-trigger"]=i.title}else console.error("Custom sets with `override` must also have the `title` property defined.");e-=1}else this.symbolSets[n]=a,n++}n>3&&(this.uiLabels["left-trigger"]="Reset",this.uiLabels["right-trigger"]="Cycle"),this.attachSymbols(),this.setupControlsUI()},onGamepadEvent:function(t){for(var e=0;e<t.length;t++){var n=t[e];this.updateWheel(n)}},updateWheel:function(t){this.gamepadConnected||(this.gamepadConnected=!0,this.showUI()),this.setDirection(t.axes),this.onButtonPress(t.buttons)},setDirection:function(t){var e=this.getPetalNum(t[0],t[1],1/this.numOfPetals*360/100);if(e){e-=1;for(var n=0;n<this.numOfPetals;n++)this.petals[n].className="petal";this.petals[e].className+=" selected",this.currentPetalNum=e}},onButtonPress:t.throttle(function(t){t[this.lastButtonDownId].pressed===!1&&(this.lastButtonIsUp=!0,this.onButtonUp());for(var e=0;e<t.length;e++){var n=t[e];if(n.pressed){if(this.lastButtonDownId===e&&!this.lastButtonIsUp)return;switch(e){case 0:case 1:case 2:case 3:this.getSymbol(e);break;case 4:this.onBackspace();break;case 5:this.onSpace();break;case 6:this.symbolSets.length<4?this.toggleSymbols(2):this.resetSymbols();break;case 7:this.symbolSets.length<4?this.toggleSymbols(1):this.cycleSymbols();break;case 12:case 13:case 14:case 15:this.onDPadPress(e)}this.lastButtonDownId=e}}},50),onButtonUp:function(){for(var t=0;t<this.buttons.length;t++){var e=this.buttons[t].style;e["-webkit-filter"]="",e.filter=""}},getSymbol:function(t){var e=4*this.currentPetalNum,n=this.buttons.slice(e,e+4),s=this.buttonMapping[t],i=n[s],a="saturate(2)";i.style["-webkit-filter"]=a,i.style.filter=a,this.onSymbolSelection(i.textContent),this.lastButtonIsUp=!1},onSymbolSelectionDefault:function(t){var n=document.getElementById("daisywheel-input"),s=e.getCursor(n),i=n.value,a=i.substring(0,s),o=i.substring(s,i.length);n.value=a+t+o,n.scrollLeft=n.scrollWidth},onBackspace:function(){var t=document.getElementById("daisywheel-input"),e=t.value;t.value=e.substring(0,e.length-1)},onSpace:function(){var t=document.getElementById("daisywheel-input");t.value+=" "},toggleSymbols:t.throttle(function(t){this.symbolSetNumber=this.symbolSetNumber===t?0:t,this.lastButtonIsUp=!1,this.attachSymbols()},50),cycleSymbols:function(){this.symbolSetNumber>this.symbolSets.length-1?this.symbolSetNumber++:this.symbolSetNumber=0,this.attachSymbols()},resetSymbols:function(){this.symbolSetNumber=0,this.attachSymbols()},onDPadPress:function(t){var n={12:"up",13:"down",14:"left",15:"right"},s=document.getElementById("daisywheel-input"),i=e.getCursor(s);switch(n[t]){case"up":e.setCursor(s,0);break;case"down":e.setCursor(s,s.value.length);break;case"left":e.setCursor(s,i-1);break;case"right":e.setCursor(s,i+1)}},getPetalNum:function(t,e,n){function s(t,e,n){return t>=e-n&&e+n>=t}var i=0,a=s(e,0,.1)&&s(t,0,.1),o=0===t&&0===e;return a||o?0:(t>n?i=s(e,0,n)?3:n>e?2:4:s(t,0,n)?n>e?i=1:e>n&&(i=5):i=s(e,0,n)?7:n>e?8:6,i)}},s={load:t.bind(n.load,n),unload:t.bind(n.unload,n),symbols:t.bind(n.symbols,n)};window.Daisywheel=s,n.init()}(_);